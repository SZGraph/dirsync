
# Скрипт синхронизации директории dirsync.pl (perl)

Скрипт разработан для рекурсивной синхронизации директории ПРИЕМНИКА с директорией ИСТОЧНИКА. 
Програмка будет полезна для синхронизации разрозненных личных проектов, например, при подготовке к почистке компьютера.

Файлы директории ИСТОЧНИКА не удаляются. Вся информация о перемещении файлов печатается в STDOUT.
Для синхронизации в обоих направлениях вызовите скрипт дважды поменяв местами параметры имени и пути к ПРИЕМНИКУ и ИСТОЧНИКУ.
Для сохранения информации о синхронизации перенаправьте вывод STDOUT в файл в консоли.

## История
Эта програмка создана под веянием *начинов* принятых в маленькой болгарской фирме, похожей на хозяйство семибаба.
Её хозяин считал, что женщины самые лучшие программисты и был горд миллионами строк написанными его подчиненными. Они писали код в котором каждую строку кода **задължително** предваряет одна или несколько строк описания, не смотря на повторы. Недостатки подхода - миллионы строк.  Достоинство подхода - код может понять не специалист. И для небольшой програмки как эта, листинг подъемен для прочтения.

## Запуск скрипта в консоли
`perl dirsync.pl <директория ИСТОЧНИКА> <директория ПРИЕМНИКА>`\
*Например*, ```perl dirsync.pl /home/.../.github /media/...github > dirsync_log.txt``` (Информация о синхронизации отпечатывается в файл dirsync_log.txt)

## Особенности dirsync.pl
Программа сравнивает файлы в ИСТОЧНИКЕ и ПРИЕМНИКЕ не только по имени и дате создания, но и по содержанию.
Первый приоритет у имени файла. Если в ПРИЕМНИКЕ нет файла или директории с тем же именем, что и в ИСТОЧНИКЕ то они целиком копируются в ПРИЕМНИК.
Второй приоритет у содержания каждого файла. Если содержания файла ИСТОЧНИКА и ПРИЕМНИКА идентичны, то копирование не произойдет.
Заметим, что сравнение файлов ограничено по-умолчанию первыми 25 МБ (может быть изменена через переменную `$PARAM_s_bytes_compare`\*). Так же, через
переменную `$PARAM_s_ignore_bytes_compare`\* можно задать количество первых байт которые не будут участвовать в сравнении (по умолчанию 0). 
Если файлы не идентичны, то учитывается время создания файлов.\
В зависимости от времени создания файлов ИСТОЧНИКА и ПРИЕМНИКА выполняется одно из действий:
* Если в ПРИЕМНИКЕ более старый файл, то к его имени добавляется ЗАДАННЫЙ пользователем суффикс перед расширением файла (параметр `$PARAM_s_suffix_old_file`\*). Файл ИСТОЧНИКА копируется с сохранением своего имени.\
Если файл в ИСТОЧНИКЕ будет снова изменен и синхронизирован, 
то предыдущий перемещенный файл ИСТОЧНИКА с идентичным именем будет переименован с добавлением порядкового номера к суффиксу.
* Если в ИСТОЧНИКЕ более старый файл, то он копируется с сохранением своего имени в архивную директорию с ЗАДАННЫМ пользователем именем 
(параметр `$PARAM_s_archive_dir_name`\*) рядом с файлом ПРИЕМНИКА.\
Если файл в ПРИЕМНИКЕ будет изменен и синхронизирован, при этом файл в ИСТОЧНИКЕ окажется не совпадающим с файлом из архивной директории, 
то файл из архивной директории получит к имени суффикс и свой порядковый номер.

\*Примечание. Переменные через которые задаются указанные настройки собраны в разделе *НАСТРАИВАЕМЫЕ ПАРАМЕТРЫ*.

## Зависимости программы dirsync.pl
Скрипт написан на perl v5.32.1\
Скрипт использует системные функции cmp, cp, mkdir и адаптирован под следующие версиии:\
	- сравнения файлов - cmp (GNU coreutils) 8.32;\
	- копирования файлов - cp (GNU diffutils) 3.8;\
	- создания каталогов - mkdir (GNU coreutils) 8.32.\
 другими версиями данных программ работоспособность скрипта не проверялась.

Замечание! В версии 8.32 функции сравнения файлов (cmp) при сравнении идентичных файлов возвращается пустая строка с переносом. 
Это ловит блок `if ($s_compare=~m/^\s*$/ )` в теле функции FileComparator(…). Если в другой версии она будет возвращать другое, 
то регулярное выражение в if нужно будет адаптировать под него.
